<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.online.chargingSystem.mapper.ChargingDetailMapper">
    
    <!-- 批量插入充电详单 -->
    <insert id="batchInsert" parameterType="java.util.List">
        INSERT INTO charging_detail (
            order_id,
            period_seq,
            period_type,
            start_time,
            end_time,
            duration,
            kwh,
            charge_rate,
            service_rate
        ) VALUES 
        <foreach collection="details" item="detail" separator=",">
            (
                #{detail.orderId},
                #{detail.periodSeq},
                #{detail.periodType},
                #{detail.startTime},
                #{detail.endTime},
                #{detail.duration},
                #{detail.kwh},
                #{detail.chargeRate},
                #{detail.serviceRate}
            )
        </foreach>
    </insert>
    
    <!-- 根据订单ID查询充电详单 -->
    <select id="findByOrderId" resultType="com.online.chargingSystem.entity.ChargingDetail">
        SELECT 
            detail_id,
            order_id,
            period_seq,
            period_type,
            start_time,
            end_time,
            duration,
            kwh,
            charge_rate,
            service_rate,
            charge_fee,
            service_fee,
            sub_total
        FROM charging_detail
        WHERE order_id = #{orderId}
        ORDER BY period_seq
    </select>
    
    <!-- 根据订单ID删除充电详单 -->
    <delete id="deleteByOrderId">
        DELETE FROM charging_detail
        WHERE order_id = #{orderId}
    </delete>
    
</mapper> 